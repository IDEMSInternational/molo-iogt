{% load wagtailcore_tags wagtailimages_tags comments static core_tags i18n %}

{% if sections %}
  <h3 class="heading heading--homepage">{% trans "Recommended" %}</h3>
    <div class="categories">
    {% for section in sections %}
          {% load_child_sections_for_section section as sub_sections %}
              {% for sub_section in sub_sections %}
              {% load_descendant_articles_for_section sub_section featured_in_homepage=True count=3 as featured_articles %}
              {% if featured_articles %}
        <ul class="subcategory-list subcategory-list{{section.get_effective_extra_style_hints}}">
              <li class="subcategory-list__item">
                  
                  <ul class="article-list">
                  {% for featured_article in featured_articles %}
                  <li class="article-list__item">
                    {% if featured_article.image %}
                      {% if forloop.first %}
                        {% image featured_article.image width-320 class="article_thumbnail--hero" %}
                      {% else %}
                        {% image featured_article.image width-90 class="article_thumbnail"  %}
                      {% endif %}
                    {% endif %}
                    {% if forloop.first %}
                    <div class="article_content--hero">
                      <h3 class="category__title">{{section.title}}</h3>
                      <span class="subcategory-list__title">{{sub_section.title}}</span>
                      <h2 class="article-list__title">{{featured_article.title}}</h2>
                      <p class="article-list__subtitle">{{featured_article.subtitle}}</p>
                      <p>{% get_comment_count for featured_article as comment_count %}</p>
                      {% if comment_count > 0 %}
                        <div class="comments-count"><a href="{% pageurl featured %}#comments-list">{{comment_count}} <span>{% trans "comment" %}{{comment_count|pluralize}}</span></a></div>
                      {% endif %}
                    </div>
                    {% else %}
                    <div class="article_content">
                      <h3 class="category__title">{{section.title}}</h3>
                      <span class="subcategory-list__title">{{sub_section.title}}</span>
                      <h2 class="article-list__title">{{featured_article.title}}</h2>
                      <p class="article-list__subtitle">{{featured_article.subtitle}}</p>
                      <!-- 5. Must have article comments -->
                    </div>
                    {% endif %}
                  </li>
                  {% endfor %}  
                 </ul>
              </li> 
      {% endif %}
          {% endfor %}
        </ul>
    {% endfor %}
    </div>   
{% endif %}
