{% load wagtailcore_tags wagtailimages_tags comments static core_tags i18n %}

{% if sections %}
<h3 class="heading heading--homepage">{% trans "Recommended" %}</h3>
<div class="section-list section-list__homepage">
  {% for section in sections %}
    {% load_descendant_articles_for_section section featured_in_homepage=True as featured_articles %}
    {% if featured_articles %}
      <div class="section-list__item section-list__item{{section.get_effective_extra_style_hints}}">
        {% load_child_sections_for_section section as sub_sections %}
        {% for sub_section in sub_sections %}
            
            <div class="section-list__sub-category">
              <ul class="article-list article-list{{section.get_effective_extra_style_hints}}">
                {% load_descendant_articles_for_section sub_section featured_in_homepage=True count=3 as featured_articles %}
                {% for featured_article in featured_articles %}
                  <li class="article-list__item">
                    {% if forloop.first %}
                    <a href="{% pageurl featured_article %}">
                       {% if featured_article.image %}
                        {% image featured_article.image width-320 class="article_thumbnail--hero" %}
                      {% endif %}
                    </a>
                    <a href="{% pageurl featured_article %}">
                      <div class="article_content--hero">
                        <h3 class="article__category--title">{{section.title}}</h3>
                        <h4 class="article__subcategory--title">{{sub_section.title}}</h4>
                        <h2 class="article__title">{{featured_article.title}}</h2>
                        <p>{{featured_article.subtitle}}</p>

                        <p>{% get_comment_count for featured_article as comment_count %}</p>
                        {% if comment_count > 0 %}
                            <div class="comments-count">
                            <a href="{% pageurl featured %}#comments-list">
                              {{comment_count}} 
                              <span>{% trans "comment" %}{{comment_count|pluralize}}</span>
                            </a></div>
                        {% endif %}
                      </div>
                    </a>
                    {% else %}
                    <a href="{% pageurl featured_article %}">
                      {% if featured_article.image %}
                        {% image featured_article.image width-90 class="article_thumbnail" %}
                      {% endif %}
                    </a>
                    <a href="{% pageurl featured_article %}">
                      <div class="article_content">
                        <h3 class="article__category--title">{{section.title}}</h3>
                        <h4 class="article__subcategory--title">{{sub_section.title}}</h4>
                        <h2 class="article__title">{{featured_article.title}}</h2>
                        <p>{{featured_article.subtitle}}</p>

                        <p>{% get_comment_count for featured_article as comment_count %}</p>
                        {% if comment_count > 0 %}
                            <div class="comments-count">
                              <a href="{% pageurl featured %}#comments-list">
                                {{comment_count}} 
                                <span>{% trans "comment" %}{{comment_count|pluralize}}</span>
                              </a></div>
                        {% endif %}
                      </div>
                    </a>
                  {% endif %}
                  </li>
                  {% endfor %}
              </ul>
            </div>
        {% endfor %}
      <!-- LOAD MORE BUTTON FOR SECTION-->
      <a href="{% pageurl section %}" class="section-list__more">{% trans "More" %}</a>
      </div>
    {% endif %}
  {% endfor %}
</div>   
{% endif %}

